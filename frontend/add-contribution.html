<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add Contribution - Gitam Student Portal</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; background:#f8f0ea; margin:0; padding:0; }
    .app-header { display:flex; justify-content:space-between; align-items:center; padding:15px; background:#333; color:#fff; }
    .container { max-width:700px; margin:30px auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,.08); }
    .form-group { margin-bottom:15px; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    input[type="text"], input[type="email"], textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; }
    button { padding:10px 16px; border:none; border-radius:6px; background:#007bff; color:#fff; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .star-rating { display:flex; flex-direction:row-reverse; justify-content:flex-end; }
    .star-rating input { display:none; }
    .star-rating label { font-size:25px; cursor:pointer; color:#ddd; }
    .star-rating input:checked ~ label { color:gold; }
    .message { margin-top:12px; font-weight:600; min-height:1.4em; }
    .error { color:#c00; }
    .ok { color: #0a6; }
    .disclaimer { margin-top:16px; font-size:0.95em; color:#333; background:#fff3f3; padding:10px; border-radius:6px; border:1px solid #ffdede; }
  </style>
</head>
<body>
  <header class="app-header">
    <h1 class="logo">Gitam Student Portal</h1>
    <div class="header-buttons">
      <span id="headerName"></span>
      <span id="headerEmail"></span>
      <button id="logoutButton" class="btn-secondary">Logout</button>
    </div>
  </header>

  <div class="container">
    <h2>Add Your Contribution</h2>

    <form id="contributionForm" method="POST">
      <div class="form-group">
        <label for="facultyName">Faculty Name:</label>
        <input type="text" id="facultyName" name="facultyName" required>
      </div>

      <div class="form-group">
        <label for="facultyEmail">Faculty Email ID:</label>
        <input type="email" id="facultyEmail" name="facultyEmail" required>
        <small>If you are unaware of the teacher's email or name, you can visit this portal:
          <a href="https://www.gitam.edu/about/faculty?campus=visakhapatnam&discipline_id=18&campus_id=All&specialization=All&type=pg_faculty&page=1" target="_blank">Gitam Faculty Portal</a>
        </small>
      </div>

      <div class="form-group">
        <label>Rating:</label>
        <div class="star-rating">
          <input type="radio" id="star5" name="rating" value="5" required><label for="star5" title="5 stars">&#9733;</label>
          <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4 stars">&#9733;</label>
          <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3 stars">&#9733;</label>
          <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2 stars">&#9733;</label>
          <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1 star">&#9733;</label>
        </div>
      </div>

      <div class="form-group">
        <label for="review">Describe your teacher (max 100 words):</label>
        <textarea id="review" name="review" rows="5" maxlength="500" required></textarea>
      </div>

      <button type="submit" id="submitBtn">Submit Contribution</button>
    </form>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> If you use any abusive words, your account and review will be deleted.
    </div>

    <p id="message" role="status" aria-live="polite" class="message"></p>
  </div>

  <script>
    (function () {
      let abusiveWords = [];

      // Load words from badword.txt
      fetch('badword.txt')
        .then(response => response.text())
        .then(text => {
          abusiveWords = text.split(/\r?\n/).map(w => w.trim().toLowerCase()).filter(Boolean);
          console.log("Loaded bad words:", abusiveWords.length);
        })
        .catch(err => {
          console.error("Could not load badword.txt", err);
        });

      function escapeRegex(s) {
        return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }

      function findAbusiveWordsInText(text) {
        if (!text || !abusiveWords.length) return [];
        const found = new Set();
        const lowerText = text.toLowerCase();
        const tokens = (lowerText.match(/[a-z0-9]+/g) || []);

        for (const raw of abusiveWords) {
          const w = String(raw).trim();
          if (!w) continue;
          const wLower = w.toLowerCase();

          if (/\s/.test(wLower)) {
            const pattern = new RegExp('(^|[^a-z0-9])' + escapeRegex(wLower) + '($|[^a-z0-9])', 'i');
            if (pattern.test(lowerText)) found.add(w);
          } else {
            if (tokens.includes(wLower)) {
              found.add(w);
            } else {
              const pattern = new RegExp('(^|[^a-z0-9])' + escapeRegex(wLower) + '($|[^a-z0-9])', 'i');
              if (pattern.test(lowerText)) found.add(w);
            }
          }
        }
        return Array.from(found);
      }

      document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('contributionForm');
        const review = document.getElementById('review');
        const submitBtn = document.getElementById('submitBtn');
        const messageBox = document.getElementById('message');

        function updateValidationUI() {
          const found = findAbusiveWordsInText(review.value || '');
          if (found.length) {
            submitBtn.disabled = true;
            messageBox.textContent = '❌ Forbidden word(s) found: ' + found.join(', ');
            messageBox.classList.add('error');
            messageBox.classList.remove('ok');
          } else {
            submitBtn.disabled = false;
            messageBox.textContent = '';
            messageBox.classList.remove('error');
            messageBox.classList.add('ok');
          }
        }

        review.addEventListener('input', updateValidationUI);

        form.addEventListener('submit', function (ev) {
          const found = findAbusiveWordsInText(review.value || '');
          if (found.length) {
            ev.preventDefault();
            submitBtn.disabled = true;
            messageBox.textContent = '❌ Forbidden word(s) found: ' + found.join(', ');
            messageBox.classList.add('error');
            messageBox.classList.remove('ok');
            return false;
          }
          return true;
        });
      });
    })();
  </script>

  <!-- Keep your backend/database connection logic -->
  <script src="script.js"></script>
</body>
</html>
